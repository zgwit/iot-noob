
# 通讯协议（NOOB）

物联小白与上位机（服务器）通讯原计划使用MQTT协议，但MQTT并不是一个好的物联网协议（1.总线不安全，2.topic冗余，3.不适合高并发），所以根据以往项目经验重新设计了一个二进制和JSON结合的协议，暂时定名为NOOB。NOOB协议使用1个字节作为包头，包体最长支持30KB（但是建议在1KB以内，因为有些网络有限制数据包体积）。数据内容支持加密传输，默认AES（AES有硬件加速，ESP32、STM32、服务器CPU都支持）。


## 包结构

包头 1字节

|消息类型|设备状态|数据加密|包体标识|
|----|----|----|----|
|4bit|2bit|1bit|1bit|

包体 2~32676

|长包标识|内容长度|[扩展长度]|内容|
|----|----|----|----|
|1bit|7bit|[8bit]|1~32676 byte|

*长包标识为1时，使用扩展长度表示长度大于127的包*


## 消息类型

| 序号 | 类型 | 方向 | 类型 | 内容 |
|----|----|----|----|----|
| 0 | NONE | - | - | - |
| 1 | CONNECT | 上行 | 鉴权 | json |
| 2 | HEARTBEAT | 上行 | 心跳 |-|
| 3 | QUERY | 下行 | 查询 |json|
| 4 | UPDATE | 下行 | 修改 |json|
| 5 | CONTROL | 下行 | 控制命令 |json|
| 6 | REPORT | 上行 | 上报状态 |json|
| 7 | EVENT | 上行 | 事件 |json|
| 8 | ALARM | 上行 | 报警 |json|
| 9 | LOG | 上行 | 日志 |string|
| 10 | APP | 下行 | 应用管理 |json|
| 11 | FS | 下行 | 文件管理 |json|
| 12 | SYSTEM | 下行 | 系统设置 |json|
| 13 | DATA | 双向 | 数据 |binary|
| 14 | FINISH | 下行 | 结束 | - |
| 15 | DISCONNECT | 双向 | 断开 |[string]|

## 消息状态

| 序号 | 类型 | 说明 |
|----|----|----|
| 0 | NORMAL | - |
| 1 | BUSY | 忙 |
| 2 | ERROR | 错误 |
| 3 | UNSUPPORTED | 不支持 |
